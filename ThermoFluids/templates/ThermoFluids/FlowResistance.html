{% extends "Base.html" %}
{% load bootstrap_toolkit %}
{% load staticfiles %}

{% block scripts_and_styles %}
<script src="{% static 'SmoUtil.js' %}"></script>
<script src="{% static 'angular-sprintf.min.js' %}"></script>

<script>
angular.module('FlowResistance', ['ui.bootstrap', 'smo', 'sprintf'])
	.config(['$httpProvider', function($httpProvider) {
	    $httpProvider.defaults.xsrfCookieName = 'csrftoken';
	    $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
	    
	}])
	.controller('FlowResistanceController', 
		[ '$scope', '$http', '$window', 'util', 'units', 'materials', 
		function($scope, $http, $window, util, units, materials) {
		
		$scope.resultComputed = false;
		$scope.units = units;
		$scope.materials = materials;
		$scope.util = util;
		
		$scope.inputVariables = {
			pipeLength : new units.Quantity('Length', 1., 'm'),
			internalDiameter : new units.Quantity('Length', 5., 'mm'),
			externalDiameter : new units.Quantity('Length', 6., 'mm'),
			surfaceRoughness : new units.Quantity('Length', 25., 'um'),
			inletPressure : new units.Quantity('Pressure', 1, 'bar'),
			inletTemperature : new units.Quantity('Temperature', 15, 'degC'),
			massFlowRate : new units.Quantity('MassFlowRate', 10, 'kg/h'),
			pipeMaterial : $scope.materials.solids['StainlessSteel304'],
			fluid : 'ParaHydrogen'
		};
		$scope.inputs = {
			name : 'Inputs',
			fields : [
				{title:'pipe length', quantity:$scope.inputVariables.pipeLength},
				{title:'internal diameter', quantity:$scope.inputVariables.internalDiameter},
          	]
		};
		
		$scope.dumpObj = function(obj) {
			return angular.toJson(obj, true);
		}
		$scope.compute = function() {
			$http({
		        method  : 'POST',
		        url     : '/ThermoFluids/FlowResistance/',
		        data    : {action : 'computePressureDrop', parameters : $scope.inputVariables},
		        headers : { 'Content-Type': 'application/x-www-form-urlencoded' }  // set the headers so angular passing info as form data (not request payload)
		    })
	        .success(function(data) {
	            $scope.results = [
					{type : 'group', name : 'Geometry', fields : [
						{name : 'fluidVolume', quantity: 'Volume', value : data.result.fluidVolume, title : 'fluid volume'},
	            		{name : 'internalSurfaceArea', quantity : 'Area', value : data.result.internalSurfaceArea, title : 'internal surface area'},
	            		{name : 'externalSurfaceArea', quantity : 'Area', value : data.result.externalSurfaceArea, title : 'external surface area'},
	            		{name : 'crossSectionalArea', quantity : 'Area', value : data.result.crossSectionalArea, title : 'cross sectional area'},
	            		{name : 'pipeSolidMass', quantity : 'Mass', value : data.result.pipeSolidMass, title : 'pipe solid mass'}
					]},
					{type : 'group', name : 'Flow', fields : [
						{name : 'inletDensity', quantity: 'Density', value : data.result.inletDensity, title : 'inlet density'},
						{name : 'fluidMass', quantity: 'Mass', value : data.result.fluidMass, title : 'fluid mass in pipe'},
						{name : 'massFlowRate', quantity: 'MassFlowRate', value : data.result.massFlowRate, title : 'mass flow rate'},
						{name : 'volumetricFlowRate', quantity: 'VolumetricFlowRate', value : data.result.volumetricFlowRate, title : 'volumetric flow rate'},
						{name : 'flowVelocity', quantity: 'Velocity', value : data.result.flowVelocity, title : 'flow velocity'},
						{name : 'Re', quantity: 'Dimensionless', value : data.result.Re, title : 'Reynolds number'},
						{name : 'zeta', quantity: 'Dimensionless', value : data.result.zeta, title : 'friction factor'},
						{name : 'dragCoefficient', quantity: 'Dimensionless', value : data.result.dragCoefficient, title : 'drag coefficient'},
						{name : 'pressureDrop', quantity: 'Pressure', value : data.result.pressureDrop, title : 'pressure drop'},
						{name : 'outletPressure', quantity: 'Pressure', value : data.result.outletPressure, title : 'outlet pressure'},
						{name : 'outletTemperature', quantity: 'Temperature', value : data.result.outletTemperature, title : 'outlet temperature'},				                                          
					]}
	            ];
	            $scope.resultComputed = true;
	        });
		}
	}]);
</script>
{% endblock %}

{% block content %}
<div ng-app="FlowResistance" ng-controller="FlowResistanceController">
	<div class="col-md-1"></div>
	<div class="col-md-10">
	<h1>Pressure losses in Pipe flow</h1>
	<h2>Input data</h2>
	<div style="position:relative; width:250mm;height:50mm">
		<object data="{% static 'ThermoFluids/StraightPipe.svg' %}" type="image/svg+xml"></object>
	    <div style="position:absolute;left:35mm;top:29mm;">
			<smo-input-quantity smo-quantity-var="inputVariables.pipeLength" smo-title="pipe length"></smo-input-quantity>
		</div>
	    <div style="position:absolute;left:150mm;top:2mm;">
			<smo-input-quantity smo-quantity-var="inputVariables.internalDiameter" smo-title="internal diameter"></smo-input-quantity>				
			<smo-input-quantity smo-quantity-var="inputVariables.externalDiameter" smo-title="external diameter"></smo-input-quantity>	
				<div style="display: inline-block;text-align: left;width: 150px;">pipe material</div>
				<div style="display: inline-block;"><select style="width: 120px;" ng-model="inputVariables.pipeMaterial" ng-options="material as material.title for (name, material) in materials.solids"></select></div>	
			<smo-input-quantity smo-quantity-var="inputVariables.surfaceRoughness" smo-title="surface roughness"></smo-input-quantity> 
	    </div>
	</div>
	<div>
		<div style="display: inline-block;text-align: left;width: 150px;">fluid</div>
		<div style="display: inline-block;"><select style="width: 120px;" ng-model="inputVariables.fluid" ng-options="name as material.title for (name, material) in materials.fluids"></select></div>	
		<smo-input-quantity smo-quantity-var="inputVariables.inletPressure" smo-title="inlet pressure"></smo-input-quantity>	
		<smo-input-quantity smo-quantity-var="inputVariables.inletTemperature" smo-title="inlet temperature"></smo-input-quantity>
		<smo-input-quantity smo-quantity-var="inputVariables.massFlowRate" smo-title="inlet mass flow rate"></smo-input-quantity>
	</div>
	<button class="btn btn-default" ng-click="compute()">Compute</button>
	<br><br><br>
	<div ng-if="resultComputed">
		<hr>
		<h2>Results</h2>
		<div>
			<smo-result-view smo-data-source="results"></smo-result-view>
		</div>
	</div>
	</div>
	<div class="col-md-1"></div>
</div>

{% endblock %}

