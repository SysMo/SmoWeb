{% extends "Base.html" %}
{% load bootstrap_toolkit %}
{% load staticfiles %}

{% block scripts_and_styles %}
<script src="{% static 'SmoUtil.js' %}"></script>
<script type="text/javascript" src="http://dygraphs.com/dygraph-dev.js"></script>
<script type="text/javascript" src="http://cavorite.com/labs/js/dygraphs-export/dygraph-extra.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script>
angular.module('TestApp', ['ui.bootstrap', 'smo'])
	.config(['$httpProvider', function($httpProvider) {
	    $httpProvider.defaults.xsrfCookieName = 'csrftoken';
	    $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
	}])
	.controller('TestController', [ '$scope', '$http', 'ModelCommunicator', function($scope, $http, ModelCommunicator) {
		$scope.testModel = {
				inputCommunicator: new ModelCommunicator(),
				resultsCommunicator: new ModelCommunicator()
			};
			
			$scope.testModel.inputCommunicator.fetchData(
				'getData', {}, function(comm){
					$scope.arrayGroup = comm.data.definitions[0].groups[0];
					$scope.dataValues = comm.data.values;
				});
}])
</script>
{% endblock %}


{% block pills %}
	<li class="active" role="presentation"><a id="testTab" data-target="#test" role="tab" data-toggle="tab">Test</a></li>
{% endblock %}

{% block content %}
<div ng-app="TestApp" ng-controller="TestController">
		<div class="page-container">		
			<h1 class="title">Test calculator</h1>
			<div ng-if="testModel.inputCommunicator.loading" class="alert alert-info" role="alert">Loading...</div>
				<div ng-if="testModel.inputCommunicator.commError" class="alert alert-danger" role="alert">Communication error: <span ng-bind="testModel.inputCommunicator.errorMsg"></span></div>
				<div ng-if="testModel.inputCommunicator.serverError" class="alert alert-danger" role="alert">Server error: <span ng-bind="testModel.inputCommunicator.errorMsg"></span>
					<div>Stack trace:</div><pre><div ng-bind="testModel.inputCommunicator.stackTrace"></div></pre>
				</div>
			
			<div ng-if="testModel.inputCommunicator.dataReceived">
{% verbatim %}
				<div class="section">
					<div smo-model-view="testModelInputs" view-type="input" communicator="testModel.inputCommunicator"></div> 
				</div>
{% endverbatim %}
			</div>
		</div>
</div>
{% endblock %}
