{% extends "Platform.html" %}
{% load bootstrap_toolkit %}
{% load staticfiles %}

{% block scripts_and_styles %}
<script src="{% static 'SmoUtil.js' %}"></script>
<script>
angular.module('testApp', ['ui.bootstrap', 'smo'])
	.controller('testController', [ '$scope', '$http', '$window', 'units', function($scope, $http, $window, units) {
	$scope.setupOptions = {
		stateVariable : [{name : 'pressure', value : 'P', unit : 'Pa'}, 
                        {name : 'temperature', value : 'T', unit : 'K'},
						{name : 'density', value : 'D', unit : 'kg/m**3'},
						{name : 'specific enthalpy', value : 'H', unit : 'J/kg' },
						{name : 'specific inner energy', value : 'U', unit : 'J/kg'},
						{name : 'specific entropy', value : 'S', unit : 'J/kg-K' },
						{name : 'vapor quality', value : 'Q', unit : ''}],
		variability : [{name : 'vary', value : 'range'}, 
		                      {name : 'be', value : 'fixed'}],
		step : [{name : 'by ', value : 'step'}, 
               {name : 'in', value : 'numSteps'}]
	};
	$scope.setup = {};
	$scope.generate = function() {
		alert(angular.toJson($scope.setup, true));
	}
	$scope.dumpObj = function(obj) {
		return angular.toJson(obj, true)
	}	

	$scope.units = units;
	$scope.v1 = new units.Quantity('Temperature', 0, 'degC');
	$scope.v2 = new units.Quantity('Pressure', 3e5, 'bar');
	$scope.v3 = new units.Quantity('Length', 7, 'mm');

}])
</script>
{% endblock %}
{% block content %}
		<form action = {% url  'SmoFluidProps:FluidProps_SetUp' %} method = "post">
		{% csrf_token %}
		<table>
			{% for field in form %}
			<tr>
			<td style=" text-align: right; font-weight: bold;">{{ field.label }} &nbsp</td><td style=" text-align: left;">{{ field }}</td>
			</tr>
			{% endfor %}
			<tr>
			<td></td>	
			<td><input style=" text-align: left;" type = "submit" name = "submit" value = "Submit"/></td>
			</tr>
		</table>
		</form>
		<br>
		{% if propsTable != None %}
		
		<table border="1" style="width:100%">
			<tr>
			{% for colName in columnNames %}
			<th>{{colName}}</th>
			{% endfor %}
			</tr>
			{% for row in propsTable %}
			<tr>
			{% for c in row%}
				<td>{{ c|stringformat:".2E" }}</td>
			{% endfor %}
			</tr>
			{% endfor %}
		</table>
		{% endif %}
		{% verbatim %}
		<div ng-app="testApp" ng-controller="testController">
			<div>
				
				Let the <select ng-model="setup.stateVariable" ng-options="stateVar.name for stateVar in setupOptions.stateVariable" ng-required="true"></select><br>
				<select ng-model="setup.stateVarVariability" ng-options="variability.name for variability in setupOptions.variability"></select>
				<span ng-switch  on="setup.stateVarVariability.value"> 
					<span ng-switch-when="fixed"> <input type="number" ng-model="setup.value">{{setup.stateVariable.unit}}</span>
					<span ng-switch-when="range"> between  <input type="number" ng-model="setup.stateVarMin">{{setup.stateVariable.unit}} 
						and <input type="number" ng-model="setup.stateVarMax"> {{setup.stateVariable.unit}}<br>
						<select ng-model="setup.stepType" ng-options="stepOpt.name for stepOpt in setupOptions.step"></select>
						<span ng-switch  on="setup.stepType.value">
							<span ng-switch-when="step"> <input type="number" ng-model="setup.step">{{setup.stateVariable.unit}}</span>
							<span ng-switch-when="numSteps"> <input type="number" ng-model="setup.numSteps"> steps</span>				
						</span> 					
					</span>
				</span>
			</div>
			<button ng-click="generate()">Generate</button>
			<br>
			<input type="number" step="any" ng-init='v1.changeUnit()' ng-model='v1.displayValue' ng-change='v1.updateQuantity()'>
			<select ng-model='v1.displayUnit' ng-options='name as name for (name, conv) in units.quantities[v1.quantity].units' ng-change='v1.changeUnit()'></select>
			<div ng-bind='dumpObj(v1)'></div>
			<p>Test here</p>
			<smo-input-quantity smo-quantity-var="v3"></smo-input-quantity>
			<div ng-bind='dumpObj(v3)'></div>
		</div>
		{% endverbatim %}
{% endblock %}
