{% extends "Platform.html" %}
{% load bootstrap_toolkit %}
{% load staticfiles %}

{% block scripts_and_styles %}
<!-- <script src="{% static 'angular-treeview/angular.treeview.js' %}"></script> -->
<!-- <link rel="stylesheet" type="text/css" href="{% static 'angular-treeview/css/angular.treeview.css' %}"> -->
<script src="{% static 'smo-treeview/smo.treeview.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'smo-treeview/smo.treeview.css' %}">

<script>
angular.module('testApp', ['ui.bootstrap', 'angularTreeview'])	
	.config(['$httpProvider', function($httpProvider) {
		$httpProvider.defaults.xsrfCookieName = 'csrftoken';
		$httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
	}])
	.controller('testController', [ '$scope', '$http', '$window', function($scope, $http, $window) {
		$scope.fileContent = null;
		getHdfFileContent = function() {
			$scope.fileContent = null;
			$http.post('/DataManagement/TestView/', {
				executeMethod : 'getHdfFileContent' 
			})
			.success(function(data){
				$scope.fileContent = data.fileContent;
// 				console.log(angular.toJson($scope.fileContent, true));
			})
			.error(function(data){
				console.log('error');
			});
		};		
		$scope.refreshTree = function() {
			console.log("Refresh");
			getHdfFileContent();
		}
		$scope.isDataSet = function(nodeType) {
			if (nodeType == 'dataset'){
				return true;
			} else {
				return false;
			}
		}
		
		$scope.isFile = function(nodeType) {
			if (nodeType == 'hdf_file'){
				return true;
			} else {
				return false;
			}
		}
		
		$scope.isInputAction = function(action) {
			console.log(action);
			if (action == "copy"){				
				return true;
			} else if (action == "move" ){
				return true;
			} else if (action == "rename"){
				return true;
			} else if (action == "createGroup"){
				return true;
			} else if (action == "createDataset"){
				return true;
			} else {
				return false;
			}
		}
		
		$scope.getActionText = function(action) {
			if (action == "copy"){
				$scope.actionText = "Enter copy destination";
			} else if (action == "move" ){
				$scope.actionText = "Enter move destination";
			} else if (action == "rename"){
				$scope.actionText = "Enter new name";
			} else if (action == "createGroup"){
				$scope.actionText = "Enter group name";
			} else if (action == "createDataset"){
				$scope.actionText = "Enter dataset name";
			} else {
				$scope.actionText = "";
			}
			
			return $scope.actionText;
		}
		
		
		$scope.actionText = "";
		
		$scope.imput = null;
		
		$scope.refreshTree();
	}]);
	
</script>
{% endblock %}

{% block content %}
<br>
<h1>Test page</h1>
<div ng-app="testApp" ng-controller="testController">
<!-- 	<div ng-if="fileContent"> -->
		<div
			data-angular-treeview="true"
		    data-tree-id="hdfView"	
			data-tree-model="fileContent"
			data-node-id="id"
			data-node-label="name"
			data-node-children="children" >
		</div>
<!-- 	</div> -->

 <br>
<form action=".">
  <div ng-show="isInputAction(hdfView.action)">
	  <div style="font-weight: bold;" ng-bind="getActionText(hdfView.action)"></div>
	  <input ng-model="input"></input>
	  <input type="submit" value="Submit">
  </div>
</form> 

<!-- <button ng-click="setCurrentNode(hdfView.currentNode.path)">Refresh</button> -->
<!-- <div ng-bind="currentNode"></div> -->
<!-- 		<button ng-click="refreshTree()">Refresh</button> -->
		
<!-- 		<table> -->
<!-- 			<tr> -->
<!-- 				<td> -->
<!-- 				<div ng-bind="hdfView.currentNode.path"></div> -->
<!-- 				</td> -->
				
<!-- 			</tr> -->
<!-- 		</table> -->
</div>
{% endblock %}