{% extends "Platform.html" %}
{% load bootstrap_toolkit %}
{% load staticfiles %}

{% block scripts_and_styles %}
<!-- <script src="{% static 'angular-treeview/angular.treeview.js' %}"></script> -->
<!-- <link rel="stylesheet" type="text/css" href="{% static 'angular-treeview/css/angular.treeview.css' %}"> -->
<script src="{% static 'smo-treeview/smo.treeview.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'smo-treeview/smo.treeview.css' %}">

<script>
angular.module('testApp', ['ui.bootstrap', 'angularTreeview'])	
	.config(['$httpProvider', function($httpProvider) {
		$httpProvider.defaults.xsrfCookieName = 'csrftoken';
		$httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
	}])
	.controller('testController', [ '$scope', '$http', '$window', function($scope, $http, $window) {
		$scope.fileContent = null;
		getHdfFileContent = function() {
			$scope.fileContent = null;
			$http.post('/DataManagement/TestView/', {
				executeMethod : 'getHdfFileContent' 
			})
			.success(function(data){
				$scope.fileContent = data.fileContent;
// 				console.log(angular.toJson($scope.fileContent, true));
			})
			.error(function(data){
				console.log('error');
			});
		};		
		
		$scope.refreshTree = function() {
			getHdfFileContent();
		}
		
		
		$scope.sendActionData = function () {
			console.log("action:" + $scope.hdfView.action);
			$http.post('/DataManagement/HdfInterface/', {
				action : $scope.hdfView.action,
				input : $scope.hdfView.input
			})
			.success(function(data){
				$scope.statusMessage = "Tree successfully modified!";
				
			})
			.error(function(data){
				$scope.statusMessage = "Error!";
			});
			
//  			$scope.input = "";
//  			$scope.hdfView.action = "";
			$scope.refreshTree();
			
		}
				
		$scope.refreshTree();
	}]);
	
</script>
{% endblock %}

{% block content %}
<br>
<h1>Test page</h1>
<div ng-app="testApp" ng-controller="testController">
<!-- 	<div ng-if="fileContent"> -->
		<div
			data-angular-treeview="true"
		    data-tree-id="hdfView"	
			data-tree-model="fileContent"
			data-node-id="id"
			data-node-label="name"
			data-node-children="children" >
		</div>
<!-- 	</div> -->

 <br>
 <div ng-show="hdfView.isInputAction(hdfView.action)">
	  <div style="font-weight: bold;" ng-bind="hdfView.getActionText(hdfView.action)"></div>
	  <input ng-model="hdfView.input"></input>
	  <button ng-click="sendActionData()">Submit</button>
 </div>


<!-- <button ng-click="setCurrentNode(hdfView.currentNode.path)">Refresh</button> -->
<!-- <div ng-bind="currentNode"></div> -->
<!-- 		<button ng-click="refreshTree()">Refresh</button> -->
		
<!-- 		<table> -->
<!-- 			<tr> -->
<!-- 				<td> -->
<!-- 				<div ng-bind="hdfView.currentNode.path"></div> -->
<!-- 				</td> -->
				
<!-- 			</tr> -->
<!-- 		</table> -->
</div>
{% endblock %}