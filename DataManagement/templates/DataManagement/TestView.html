{% extends "Base.html" %}
{% load bootstrap_toolkit %}
{% load staticfiles %}

{% block scripts_and_styles %}
<script src="{% static 'smo-datatable/smo.datatable-test.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'smo-datatable/smo.datatable.css' %}">
<script src="{% static 'smo-treeview/smo.treeview-test.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'smo-treeview/smo.treeview.css' %}">
<!--Load the AJAX API-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<!-- <script src='https://www.google.com/jsapi?autoload={"modules":[{"name":"visualization","version":"1","packages":["corechart","table", "controls"]}]}'></script> -->
<script type="text/javascript" src="http://dygraphs.com/dygraph-dev.js"></script>
<script src="{% static 'smo-datatable/tablequerywrapper.js' %}"></script>


<script>
	angular.module('testApp', ['ui.bootstrap', 'smoDataTableModule', 'angularTreeview'])
	.controller('testController', [ '$scope', '$http', '$window', function($scope, $http, $window) {		
		$scope.columnTable = {columns:[], data:[]};
		$scope.tableLoaded = false;
		$scope.columnsShow = [];
		
		$scope.initTable = function(){
			$scope.tableArray = [];
			var columnLabels = [];
			for (i=0; i<$scope.columnTable.columns.length; i++){
				$scope.columnsShow[i] = true;
				columnLabels.push($scope.columnTable.columns[i].name);
			}
			$scope.tableArray.push(columnLabels);
			for (i=0; i<$scope.columnTable.data.length; i++){
				$scope.tableArray.push($scope.columnTable.data[i]);
			}
		}
		
		$scope.plotData = function(){
			
			 google.load('visualization', '1.0', {'packages':["corechart", "table", "controls"], 
				 "callback" : drawPlot}); 
		     function drawPlot() {
// 		       var data = google.visualization.arrayToDataTable($scope.tableArray);
		       var chart1 = new Dygraph.GVizChart(
			            document.getElementById('dygraphs')).draw($scope.view, {
			            	labelsDiv: 'dylegend',
			            	labelsDivWidth: 150,
			            	labelsSeparateLines: true,
			            	width: 900,
			            	height: 500
			            });
		       
	
		     }
		     $scope.showPlot = !$scope.showPlot;
		     if ($scope.plotBtnText == "Show plot"){
		    	 $scope.plotBtnText ="Hide plot";
		     } else {
		    	 $scope.plotBtnText = "Show plot";
		     }
		 }
		
		$scope.drawTable = function (){
			google.load('visualization', '1.0', {'packages':["corechart", "table", "controls"], 
				 "callback" : displayTable}); 
			function displayTable(){
				var data = google.visualization.arrayToDataTable($scope.tableArray);
				console.log($scope.tableArray[0]);
 		      var formatter = new google.visualization.NumberFormat({pattern: '###.###'});
 		     	formatter.format(data,1);
 		     	formatter.format(data,2);
 		     	
 		       
		       var table = new google.visualization.Table(document.getElementById('table_div'));
		       table.draw(data, {showRowNumber: true, sort:'disable', page:'enable', pageSize:20});
		       $scope.view = new google.visualization.DataView(data);

			}
			$scope.showTable = !$scope.showTable;
		     if ($scope.tableBtnText == "Show table"){
		    	 $scope.tableBtnText ="Hide table";
		     } else {
		    	 $scope.tableBtnText = "Show table";
		     }
		     
			
		}
		
		$scope.setView = function (){
			var viewCloumns = [];
		       for (i=0; i<$scope.columnsShow.length; i++){
		    	  if ($scope.columnsShow[i] == true){
		    		  viewCloumns.push(i);
		    	  }
		       }
		       $scope.view.setColumns(viewCloumns);
		}
		
		$scope.drawView = function (){
			google.load('visualization', '1.0', {'packages':["corechart", "table", "controls"], 
				 "callback" : displayView}); 
			function displayView(){
				$scope.setView();
				var data = google.visualization.arrayToDataTable($scope.tableArray);
// 		       $scope.view = new google.visualization.DataView(data);
// 		       var viewCloumns = [];
// 		       for (i=0; i<$scope.columnsShow.length; i++){
// 		    	  if ($scope.columnsShow[i] == true){
// 		    		  viewCloumns.push(i);
// 		    	  }
// 		       }
// 		       $scope.view.setColumns(viewCloumns);
		       var tableView = new google.visualization.Table(document.getElementById('view_div'));
		       tableView.draw($scope.view, {showRowNumber: true, sort:'disable', page:'enable', pageSize:20});
			}
			
			$scope.showView = !$scope.showView;
		     if ($scope.viewBtnText == "Show view"){
		    	 $scope.viewBtnText ="Hide view";
		     } else {
		    	 $scope.viewBtnText = "Show view";
		     }
		     
			
		}
		
	}]);
// 	.directive('newWindow', ['$window', '$compile',
//   function($window, $compile) {
//     return {
//       restrict: 'EA',
//       link: function($scope, $element, attr) {
//         $element.on('$destroy', function() {
//           $scope.window.close();
//         });
//       },
//       controller: function($scope, $element) {
//         $scope.window = $window.open('', '_blank');
//         angular
//           .element($scope.window.document.body)
//           .append($compile($element.contents())($scope));
//       }
//     }
//   }]);
     
</script>



{% endblock %}

{% block content %}
<div ng-app="testApp" ng-controller="testController">
	<div class="container">
		<div class="row">
			<div class="col-md-2" style="text-align: left; font-weight: bold; font-size: medium;">
				Explore data file:
			</div>
			<div class="col-md-10">
				<smo-hdf-browser tree-id="hdfView"></smo-hdf-browser>
			</div>
		</div>
		<br>
	<!-- 	<smo-data-table ng-show="columnTable.columns" table-model="columnTable"></smo-data-table>	 -->
		
		<div class="row">
			<div ng-show="tableLoaded" class="col-md-6" style="text-align: left; font-size: medium;">
				<span><button class="button class="btn btn-default btn-sm" ng-click="plotData()" ng-bind="plotBtnText">
				</button></span>
				<span><button class="button class="btn btn-default btn-sm" ng-click="drawTable()" ng-bind="tableBtnText">
				</button></span>
				<span><button class="button class="btn btn-default btn-sm" ng-click="drawView()" ng-bind="viewBtnText">
				</button></span>
			</div>
			<div class="col-md-6">
			</div>
		</div>
		<div class ="row" ng-show="showTable">
			<div class="col-md-12">
				<div style="display:inline-block;" ng-repeat="columnName in tableArray[0] track by $index">
					<span ng-bind="columnName"></span>
					<input type="checkbox" ng-model="columnsShow[$index]"></input>
    			</div>
			</div>
		</div>
		<div class="row" ng-show="showTable">
			<div class="col-md-12">
				<div id="table_div"></div>	
			</div>		
		</div>
		<div class="row" ng-show="showView">
			<div class="col-md-12">
				<div ng-show="showView" id="view_div"></div>	
			</div>		
		</div>
		<div class="row" ng-show="showPlot">
			<div class="col-md-10">
	    		<div id="dygraphs"></div>
			</div>
			<div class="col-md-2">
				<div id="dylegend"></div>
			</div>
		</div>
	</div>
</div>



{% endblock %}